<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="cartMapper">
    <!-- 1:1 매칭엔 association // 1:n 매칭엔 collection -->
    <resultMap id="cart" type="com.green.Shop.cart.vo.CartVO">
        <id     column="CATE_CODE"  property="cartCode" />
        <result column="ITEM_CODE"  property="itemCode" />
        <result column="CART_CNT"   property="cartCnt" />
        <result column="MEM_ID"     property="memId" />
        <result column="CART_DATE"  property="cartDate" />
        <association property="itemVO" resultMap="itemMapper.item"/>
    </resultMap>

        <!-- 장바구니 담기 버튼 누르면 등록 -->
        <insert id="insertCart" >
            INSERT INTO SHOP_CART (
                ITEM_CODE,
                CART_CNT,
                MEM_ID
                )
            VALUES (
                #{itemCode},
                #{cartCnt},
                #{memId}
                )
        </insert>


        <!-- 아래의 코드를 구현하려면
            DB의 SHOP_CART 안에 있는
            cart_code, item_code, cart_cnt, cart_date, mem_id는 조회가 가능함.
            하지만, 화면에 표시되어야하는 item_name, item_price, attached_file_name이 조회가 불가능 하기에

            SHOP_CART와 SHOP_ITEM은 1:1로 연결할 수 있기에
            CART를 조회하면서 SHOP_ITEM의 내용도 같이 조회해야하기에
            <resultMap id="cart" type="com.green.Shop.cart.vo.CartVO"> 안에
            assosiation을 부여해줌.
            id는 item_name, item_price를 조회해야 하기에 아래에 설정해줌 ( cart resultMap에 )

            또한, 아이템 ( 장바구니에 등록된 ) 에는 이미지가 여러개 들어갈 수 있음.
            고로 SHOP_ITEM과 ITEM_IMG는 1:N의 관계가 성립됨.

            그러기에 마찬가지로 위와 같이 설정해주지만,
            1:다의 관계에서는 collection을 사용함.
        -->
        <select id="getCartList" resultMap="cart">
            SELECT cart_code, cart_cnt, mem_id,
            DATE_FORMAT(cart_date, '%Y-%m-%d %H-%i') AS CART_DATE
            , item_name, item_price, attached_file_name
            FROM shop_cart c, shop_item i, item_img img
            WHERE c.item_code = i.item_code
            AND c.item_code = img.item_code
            AND MEM_ID = #{memId}
            AND IS_MAIN = 'Y';
        </select>

</mapper>































